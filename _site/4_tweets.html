

<html>
  <head>
  
    <title>Tweet Text Mining | Text Mining in R</title>
    
       <link rel="stylesheet" href="css/styles.css" type="text/css">
    <link rel="stylesheet" href="css/solarized-dark.css" type="text/css">
    <link rel="stylesheet" href="css/solarized-light.css" type="text/css">    

  </head>
  <body>
    


<div class="banner">
  <h1 style="font-size:3rem";>Text Mining in R</h1>

  <nav class="nav">
    <a href="index">About</a>
    <a href="contents">Contents</a>    

  <hr>

  
  <h1>Tweet Text Mining</h1>
  

</div>




    <p>This tutorial is heavily based on the tutorial written by Leah Wasser and Carson Farmer, <a href="here">https://www.earthdatascience.org/courses/earth-analytics/get-data-using-apis/text-mining-twitter-data-intro-r/</a>.</p>

<h1 id="searching-for-tweets-related-to-climate">Searching for Tweets Related to Climate</h1>

<h2 id="packages">Packages</h2>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># load twitter library - the rtweet library is recommended now over twitteR
</span><span class="n">library</span><span class="p">(</span><span class="n">rtweet</span><span class="p">)</span><span class="w">
</span><span class="c1"># plotting and pipes - tidyverse!
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="c1"># text mining library
</span><span class="n">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span><span class="w">
</span><span class="c1"># plotting packages
</span><span class="n">library</span><span class="p">(</span><span class="n">igraph</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggraph</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="how-to-get-data-with-twitter-api">How to get data with Twitter API</h2>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1">#climate_tweets &lt;- search_tweets(q = "#climatechange", n = 10000,
#                                      lang = "en",
#                                      include_rts = FALSE)
#save_as_csv(x = climate_tweets, "climate_tweets.csv", prepend_ids = TRUE, na = "NA",
#  fileEncoding = "UTF-8")
</span></code></pre>
</div>

<h2 id="pre-found-tweets-about-climate-change">Pre-found tweets about Climate Change</h2>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">climate_tweets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"./climate_tweets.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">climate_tweets</span><span class="o">$</span><span class="n">text</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="cleaning-tweets">Cleaning Tweets</h1>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># remove urls tidyverse is failing here for some reason
#climate_tweets &lt;- climate_tweets %&gt;%
#  mutate_at(c("stripped_text"), gsub("http.*","",.))
</span><span class="w">
 </span><span class="n">climate_tweets</span><span class="o">$</span><span class="n">stripped_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"http.*"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="w">  </span><span class="n">climate_tweets</span><span class="o">$</span><span class="n">text</span><span class="p">)</span><span class="w">
 </span><span class="n">climate_tweets</span><span class="o">$</span><span class="n">stripped_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"https.*"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">climate_tweets</span><span class="o">$</span><span class="n">stripped_text</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="unnest-tokens-with-stripped-text">Unnest tokens with stripped text</h2>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># remove punctuation, convert to lowercase, add id for each tweet!
</span><span class="n">climate_tweets_clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">climate_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">stripped_text</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unnest_tokens</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">stripped_text</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="remove-stop-words">Remove Stop Words</h2>

<p>Just so it’s clear, here’s what the top 15 words would be if we don’t remove stop words.</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">climate_tweets_clean</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">top_n</span><span class="p">(</span><span class="m">15</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count"</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Unique words"</span><span class="p">,</span><span class="w">
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count of unique words found in tweets"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Let’s see how many words are in the data already based on the number of rows</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">nrow</span><span class="p">(</span><span class="n">climate_tweets_clean</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now let’s load the stop_words <code class="highlighter-rouge">tidytext()</code> package and remove them from our data.</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># load list of stop words - from the tidytext package
</span><span class="n">data</span><span class="p">(</span><span class="s2">"stop_words"</span><span class="p">)</span><span class="w">

</span><span class="c1"># remove stop words from your list of words
</span><span class="n">cleaned_tweet_words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">climate_tweets_clean</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">anti_join</span><span class="p">(</span><span class="n">stop_words</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>There should now be fewer words</p>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># there should be fewer words now
</span><span class="n">nrow</span><span class="p">(</span><span class="n">cleaned_tweet_words</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Let’s plot the top 15 words</p>
<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># plot the top 15 words
</span><span class="n">cleaned_tweet_words</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">top_n</span><span class="p">(</span><span class="m">15</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
      </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count"</span><span class="p">,</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Unique words"</span><span class="p">,</span><span class="w">
      </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count of unique words found in tweets"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="networks-of-words-ngrams">Networks of Words (ngrams)</h1>

<p>ngrams specifies pairs and 2 is the number of words together</p>

<pre><code class="language-{r}"># library(devtools)
# install_github("dgrtwo/widyr")
library(widyr)

# remove punctuation, convert to lowercase, add id for each tweet!
climate_tweets_paired_words &lt;- climate_tweets %&gt;%
  dplyr::select(stripped_text) %&gt;%
  unnest_tokens(paired_words, stripped_text, token = "ngrams", n = 2)

climate_tweets_paired_words %&gt;%
  count(paired_words, sort = TRUE)
</code></pre>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">climate_tweets_separated_words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">climate_tweets_paired_words</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">separate</span><span class="p">(</span><span class="n">paired_words</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"word1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"word2"</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" "</span><span class="p">)</span><span class="w">

</span><span class="n">climate_tweets_filtered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">climate_tweets_separated_words</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">word1</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">word2</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">)</span><span class="w">

</span><span class="c1"># new bigram counts:
</span><span class="n">climate_words_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">climate_tweets_filtered</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">count</span><span class="p">(</span><span class="n">word1</span><span class="p">,</span><span class="w"> </span><span class="n">word2</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">climate_words_counts</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>


    
<div class="nav" style="margin-top: 3em">
<div style="text-align:center">§</div>
<p style="text-align: center">
<a href="https://cupop.columbia.edu/)">Columbia Population Research Center</a>
<br>
<a href="https://rcfoundations.research.columbia.edu/">Foundations for Research Computing</a>
</p>
</div>
    

  </body>
  
